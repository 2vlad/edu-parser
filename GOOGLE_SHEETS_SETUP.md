# Google Sheets Integration Setup

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö —Å Google Spreadsheets.

## üìã –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–∫—Ä–µ–π–ø–µ—Ä–æ–≤
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —É–¥–æ–±–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ: –≤—É–∑ | –ø—Ä–æ–≥—Ä–∞–º–º–∞ | –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ | –¥–∞—Ç–∞
- ‚úÖ –û—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –¥–∞—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Data_2025_07_23`)
- ‚úÖ –ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- ‚úÖ –û—Ç–º–µ—Ç–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install google-api-python-client google-auth python-dotenv
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ Google Cloud –ø—Ä–æ–µ–∫—Ç–∞

1. –ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ https://console.cloud.google.com/
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –í–∫–ª—é—á–∏—Ç—å Google Sheets API:
   - APIs & Services ‚Üí Library
   - –ù–∞–π—Ç–∏ "Google Sheets API"
   - –ù–∞–∂–∞—Ç—å "Enable"

### 3. –°–æ–∑–¥–∞–Ω–∏–µ Service Account

1. –í Google Cloud Console:
   - IAM & Admin ‚Üí Service Accounts
   - Create Service Account
   - –ù–∞–∑–≤–∞–Ω–∏–µ: `edu-parser-sheets`
   - –û–ø–∏—Å–∞–Ω–∏–µ: `Service account for edu-parser Google Sheets integration`

2. –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á:
   - –í—ã–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
   - Keys ‚Üí Add Key ‚Üí Create new key
   - –¢–∏–ø: JSON
   - –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª

### 4. –°–æ–∑–¥–∞–Ω–∏–µ Google Spreadsheet

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É: https://sheets.new
2. –ù–∞–∑–≤–∞—Ç—å –µ—ë, –Ω–∞–ø—Ä–∏–º–µ—Ä: "Edu Parser Data"
3. –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å service account:
   - Share ‚Üí –¥–æ–±–∞–≤–∏—Ç—å email service account
   - –ü—Ä–∞–≤–∞: Editor
   - –£–±—Ä–∞—Ç—å –≥–∞–ª–æ—á–∫—É "Notify people"

4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å ID —Ç–∞–±–ª–∏—Ü—ã –∏–∑ URL:
   ```
   https://docs.google.com/spreadsheets/d/–í–ê–®–ê_SPREADSHEET_ID/edit
   ```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤–∏—Ç—å –≤ `.env` —Ñ–∞–π–ª:

```bash
# Google Sheets Integration
GOOGLE_SPREADSHEET_ID=–≤–∞—à–∞_spreadsheet_id_–∑–¥–µ—Å—å
GOOGLE_CREDENTIALS_JSON={"type":"service_account","project_id":"your-project-id",...}
```

**–í–Ω–∏–º–∞–Ω–∏–µ**: –í–µ—Å—å JSON credentials –Ω—É–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ!

### 6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
python setup_google_sheets.py
```

–°–∫—Ä–∏–ø—Ç –ø–æ–º–æ–∂–µ—Ç –ø–æ—à–∞–≥–æ–≤–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
python test_google_sheets.py
```

### –†—É—á–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

```bash
python -c "from core.google_sheets import sync_to_sheets; sync_to_sheets()"
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã

```bash
python -c "from core.google_sheets import sync_to_sheets; sync_to_sheets('2025-07-23')"
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Google Sheets

–ö–∞–∂–¥—ã–π –ª–∏—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

| –≤—É–∑ | –ø—Ä–æ–≥—Ä–∞–º–º–∞ | –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—è–≤–ª–µ–Ω–∏–π | –¥–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | scraper_id |
|-----|-----------|----------------------|------------------|------------|
| –ù–ò–£ –í–®–≠ | –û–ù–õ–ê–ô–ù –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö | 366 | 2025-07-23 | hse_–∞–Ω–∞–ª–∏—Ç–∏–∫–∞_–±–æ–ª—å—à–∏—Ö_–¥–∞–Ω–Ω—ã—Ö |
| –ú–§–¢–ò | Contemporary combinatorics | 14 | 2025-07-23 | mipt_contemporary_combinatorics |
| –ú–ò–§–ò | –ù–∞—É–∫–∏ –æ –¥–∞–Ω–Ω—ã—Ö | 315 | 2025-07-23 | mephi_–Ω–∞—É–∫–∏_–æ_–¥–∞–Ω–Ω—ã—Ö |

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

1. **–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ cron –∑–∞–ø—É—Å–∫–∞** (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 23:59)
2. **–ü–æ—Å–ª–µ —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞** —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "Run All Scrapers Now"

–õ–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ Railway:
```
‚úÖ Successfully synced data to Google Sheets
‚ö†Ô∏è Google Sheets sync skipped (not configured)
‚ùå Google Sheets sync error: [error details]
```

## üõ†Ô∏è Troubleshooting

### –û—à–∏–±–∫–∞ "Sheets API not enabled"
```
Enable the Google Sheets API in Google Cloud Console
```

### –û—à–∏–±–∫–∞ "Permission denied"
```
Check that the service account has Editor access to the spreadsheet
```

### –û—à–∏–±–∫–∞ "Invalid JSON credentials"
```
Verify GOOGLE_CREDENTIALS_JSON is properly formatted JSON in one line
```

### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è
```
Check that both GOOGLE_CREDENTIALS_JSON and GOOGLE_SPREADSHEET_ID are set
```

## üìà Railway Deployment

–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –≤ Railway –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

1. Railway Dashboard ‚Üí Variables
2. –î–æ–±–∞–≤–∏—Ç—å:
   - `GOOGLE_SPREADSHEET_ID`: ID –≤–∞—à–µ–π —Ç–∞–±–ª–∏—Ü—ã
   - `GOOGLE_CREDENTIALS_JSON`: JSON credentials (–≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ!)

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ø–ª–æ–µ.

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ Service Account –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –ª–∏—á–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ (—Ç–æ–ª—å–∫–æ Sheets API)
- ‚úÖ Credentials —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç OAuth –ø–æ—Ç–æ–∫–∞

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ

–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π:

```python
from core.google_sheets import GoogleSheetsSync

sheets = GoogleSheetsSync()
sheets.sync_historical_data(days=7)  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ª–∏—Å—Ç–∞

```python
from core.google_sheets import GoogleSheetsSync

sheets = GoogleSheetsSync()
sheet_id = sheets.get_or_create_sheet("Custom_Sheet_Name")
```

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ—Ä–µ–∑ `python test_google_sheets.py`
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ
4. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ Railway/–ª–æ–∫–∞–ª—å–Ω–æ

---

üí° **–°–æ–≤–µ—Ç**: –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é –∑–∞–ø–∏—Å—å, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!